name: Publish NuGet Package
on:
  workflow_dispatch:

jobs:
  determine-if-publish-necessary:
    runs-on: ubuntu-latest
    steps:
      - name: echo dir
        shell: bash
        run: echo ${{ github.workspace }}
      - name: test
        shell: bash
        run: dotnet run --project ./iac/DetermineIfPublishNecessary/DetermineIfPublishNecessary.csproj
      - name: check
        shell: bash
        run: |
          result=$(dotnet run --project /.iac/DetermineIfPublishNecessary/DetermineIfPublishNecessary.csproj)
          echo "::set-output name=publish-necessary::$result"
  nuget-approval:
    runs-on: ubuntu-latest
    environment: "nuget-publish-approval"
    needs: determine-if-publish-necessary
    if: needs.determine-if-publish-necessary.outputs.publish-necessary == 'true'
    steps:
      - name: approve
        shell: bash
        run: echo "Nuget publish approved"
